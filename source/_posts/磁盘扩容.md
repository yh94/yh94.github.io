---
title: 磁盘扩容
date: 2020-05-30 
tags: 
 - 系统 
categories: 
 - 系统
---
# [案例]如何磁盘扩容
> 背景：日常工作中经常会遇到磁盘空间不足的情况，在服务器磁盘不足的情况中通常使用最快以及最灵活的lvm扩容方式进行

> 问题：如何通过lvm扩容磁盘，一般形式通过fdisk初始化挂载硬盘，然后通过pvc及vge相关命令进行相关磁盘格式处理，最后完成挂载
- 处理方法 通过fdisk命令初始化挂载的硬盘（fdisk /dev/vda）并且输入n进入新增磁盘步骤。Partition type部分输入p新增磁盘，随后进入选择分区号，可以直接回车默认分区号（此时需记录对应分区号，后面找磁盘方便），紧接着进入扇区编辑步骤，可根据需要扩容大小分配起始扇区及last扇区，完成后此两数值差为此磁盘大小。完成以上步骤后输入w保存所有操作，如操作过程有误可按ctrl c退出命令不保存相关操作。至此为之已完成磁盘初始化，此时需重启电脑重新挂载该磁盘生效相关配置。重启完毕后可以通过lsblk或者df -h找到分区后磁盘名字如vda3,此时可通过pvcreate 对应磁盘名字（/dev/vda3）进行pv创建。创建完毕后需查看需扩容磁盘所属group，查询完毕后通过命令vgextend创建vg（vgextend centos（此为查询得到的group） /dev/vda3）。挂载完毕后可通过命令lvdisplay查看所有lvm状态。查看之后通过命令lvextend将新磁盘挂载入需扩容磁盘同一目录（lvextend /dev/centos/home（此为需扩容磁盘目录） /dev/vda3（此为新建磁盘） -L +900G（此为需要扩容的对应磁盘大小））。完成后通过命令xfs_growfs刷新磁盘（xfs_growfs /dev/mapper/centos-home（此为需扩容磁盘目录））。至此完成磁盘扩容所有步骤，可再次通过命令lsblk或df -h查看磁盘大小。

- 问题思考:
  由于lvm方式扩容简单且灵活，但一旦磁盘出现故障很难进行恢复或拆分等操作，因此该模式也存在一定风险，所以对于重要服务器一般创建磁盘时就需分配足够磁盘空间，同时定时做好备份。
