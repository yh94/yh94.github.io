---
title: 多线程简单聊聊？
date: 2021-12-05
tags: 
 - java 
 - 多线程
categories: 
 - java
 - 多线程
---

# 简单聊一下多线程

 线程 && 进程？
- 进程：系统进行资源分配和调度的独立单位，每个进程都有自己内存空间和系统资源，多处理机环境下的进程调度，分派，切换时要耗费较大时间和空间开销。

- 线程：线程就是进程调度的基本功能（单位）。
 
 为什么使用多线程？
- 提高系统资源利用率（Cpu），现在系统基本都是多核，只用单线程就只用到了一个核心。
 
像我们日常工作中，web系统用的是Tomcat，Tomcat处理每一个请求都会从线程池里边拿线程处理。

还有连接数据库的连接池 Druid/C3P0/DBCP 都用了多线程。

然后我在工作中其实有很多场景可以用多线程：
有一个自定义报表的场景：用户必须进行全表查询，还有导表等等，可以分片，统一返回。
还有像我们的开票功能，在生成订单的时候开一个线程同步去开票。

如何保证线程安全？
- 1、保证操作原子性，cas 可以用automic类。
- 2、操作可见行，volatile
- 3、涉及线程控制，一次多少个线程，CountDownLatch/Semaphore
- 4、集合考虑 java.util.concurrent下面的包
- 5、synchorized无法满足，考虑lock下面的包 CopyOnWriteArrayList CopyOnWriteArraySet

死锁，如何避免？
- 加锁顺序，用hash值的大小来固定
- 缩小加锁范围，共享变量才加锁
- 使用可释放的定时锁
- 
